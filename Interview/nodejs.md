# Nodejs相关面试题整理

## 一、微任务与宏任务的区别
任务队列中的都是已经完成的异步操作，而不是说注册一个异步任务就会被放在这个任务队列中，就像在银行中排号，如果叫到你的时候你不在，那么你当前的号牌就作废了，柜员会选择直接跳过进行下一个客户的业务处理，等你回来以后还需要重新取号

在当前的微任务没有执行完成时，是不会执行下一个宏任务的

在同步代码执行完成后才回去检查是否有异步任务完成，并执行对应的回调，而微任务又会在宏任务之前执行

### 宏任务有哪些

|  任务  | 浏览器  |  Node  |
| ----- | ------ | ------ |
| I/O | Yes | Yes |
| setTimeout | Yes | Yes |
| setInterval | Yes | Yes |
| setImmediate | \ | Yes |
| requesetAnimationFrame | Yes | \ |

* `UI Renader`: [HTML规范文档](https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model)提到是与微任务平行的操做步骤，应该输入微任务
* `requestAnimationFrame`: [MDN定义]下次页面重绘前所执行的操做。而重绘是作为宏任务存在的，并且`requestAnimationFrame`执行晚于微任务的执行。所以应该为宏任务
* `IO`: 何为`IO`: Dom事件响应、网络请求加载等。与程序产生交互的都成为IO

#### 宏任务的特性
1. 宏任务所处的队列就是宏任务队列
2. 第一个宏任务队列中只有一个任务：执行主线程上的JS代码；如果遇到宏任务的异步任务，会创建出一个新的宏任务队列，存放这些异步函数执行完成后的回调函数。
3. 宏任务队列可以有多个
4. 宏任务中可以创建微任务，但是在宏任务中创建的微任务不会影响当前宏任务的执行
5. 当一个宏任务队列中的任务全部执行完后，会查看是否有微任务队列，如果有就会优先执行微任务队列中的所有任务，如果没有就查看是否有宏任务队列


### 那些任务是微任务

|  任务  | 浏览器 | Node |
| ----- | ----- | ---- |
| process.nextTick | \ | Yes |
| MutationObserver | Yes | \ |
| promise.then catch finally | Yes | \ |

* Promise.prototype.then 具有代表性的微任务(Promise/A+规范中，Promise可以是宏任务，也可以是微任务。普遍将其认同为微任务，Chrome也是这样实现的)

#### 微任务的特性
1. 微任务所处的队列就是微任务队列
2. 在上一个宏任务队列执行完毕后，如果有微任务队列就会执行微任务队列中的所有任务
3. new promise((resolve)=>{ 这里的函数在当前队列直接执行 }).then( 这里的函数放在微任务队列中执行 )
4. 微任务队列上创建的微任务，仍会阻碍后方将要执行的宏任务队列 (EXP2)
5. 由微任务创建的宏任务，会被丢在异步宏任务队列中执行 (EXP4)
