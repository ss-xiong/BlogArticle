# webAttack

## XSS (Cross Site Scripting)
* 简介: 恶意攻击者往Web里面插入Script代码，当用户浏览该页面时，嵌入Web里面中的Script会被执行，从而达到恶意攻击用户的目的
* 常见类型:
  * 储存形: 1. 攻击者将恶意代码提交到目标网站数据库中；2. 用户打开目标网站时，网站取出恶意代码拼接成HTML返回给浏览器；3. 用户浏览器收到响应后执行，混在其中的恶意代码也被执行；4. 恶意代码发送用户数据到攻击者网站，或者冒充用户行为。常见场景：论坛发帖、商品评论、用户私信等
  * 反射性：1. 攻击者构造特殊URL(其中包含恶意代码); 2. 用户打开带有恶意代码的URL时，网站服务端将恶意代码从URL中取出，拼接在HTML返回给浏览器；3. 用户浏览器接收到响应后执行，混在其中的恶意代码也被执行；4.恶意代码发送用户数据到攻击者网站、或者冒充用户行为。由于需要用户主动打开恶意URL链接，攻击者往往会结合多种手段诱导用户点击
  * DOM型：1. 攻击者构造出特殊的URL，其中包含恶意代码；2. 用户打开带有恶意代码的URL；3. 用户浏览器接收到响应后解析执行，前端JS取出URL中的恶意代码执行; 4. 恶意代码窃取用户数据或者冒充用户行为。全是前端的操作
* 怎样防御
  * XSS的两大要素：1.攻击者提交恶意代码；2.浏览器执行恶意代码
  * 防范手段：
    * 输入、输出过滤：前端、后端都需要对用户输入数据进行过滤;
    * 前端处理：1.纯前端渲染，隔离代码与数据(setTextContent而非innerHTML); 2.对HTML做充分转义
    * 避免使用HTML内联事件：onload/onerror/onclick等内联事件避免使用。(避免eval/setTimeout/setInterval等支持传入字符串)
    * 使用CSP策略：严格的CSP策略可以防范此问题(禁止加载外域代码/禁止外域提交/禁止内联脚本运行等，有局限性)
    * 严格Cookie管理: 禁止JS读取Cookie
    * 提交危险操作验证: 执行危险操作时候使用二次验证

## CSRF (Cross Site Request Forgeries)
* 简介：CSRF是攻击者借助受害者的Cookie骗取服务端的信任，可以在受害者毫不知情的情况下以受害者的名义伪造请求发送给攻击者服务器，从而在未授权的情况下执行保护权限保护之下的操作。攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击网站执行某项操作的目的
* 常见类型：
  * GET：直接发送一个GET请求
  * POST提交的表单(自动提交)，诱导用户打开之后提交一个表单
  * 链接类型：论坛中发布恶意链接，诱导用户打开三方网站(XSS是直接执行操作)
* 怎样防御:
  * 两个特点：1. CSRF(通常)发生在第三方域名；2. CSRF攻击者不能获取到Cookie等信息，只是使用
  * 同源检测：不予许不明外域访问敏感数据(Origin/Referer验证。可以伪造)
  * 使用SameSite Cookie：老版本浏览器可能无效
  * 提交信息使用本域才能获取的信息：CSRF Token(token输出到页面中，不在Cookie)、双重Cookie验证(cookie存入url返回)